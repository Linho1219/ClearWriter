<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Clear Writer</title>
    <link rel="stylesheet" href="./Clear_Writer_files/codemirror.css">
    <script src="./Clear_Writer_files/codemirror.js"></script>
    <script src="./Clear_Writer_files/xml.js"></script>
    <script src="./Clear_Writer_files/markdown.js"></script>
    <script src="./Clear_Writer_files/jquery.min.js"></script>
    <script src="./Clear_Writer_files/jquery.fullscreen.js"></script>

    <style id="control"></style>
    <style type="text/css">
        *{
            font-family: var(--mainfont);
        }

        html{
            height:100%;
        }

        *::selection {
            background-color: var(--selection) !important;
        }

        *::-moz-selection {
            background-color: var(--selection) !important;
        }

        *::-webkit-selection {
            background-color: var(--selection) !important;
        }

        /*æ»šåŠ¨æ¡*/
        ::-webkit-scrollbar {
            width: 7px;
            background: #0000;
        }

        ::-webkit-scrollbar-track {
            background-color: #0000;
        }

        ::-webkit-scrollbar-thumb {
            background-color: var(--line) !important;
            border-radius:7px;
        }

        #board {
            height: 80%;
            margin: 5% 5% 0 5%;
            overflow: auto;
        }

        #ctn,
        #ctn > form {
            height: 100%;
        }

        .CodeMirror {
            line-height: 35px;
            font-family: var(--mainfont),monospace;
            font-size: 20px;
            background: var(--background);
            color: #aaa;
            height: 100%;
        }

        a {
            color: #aaa;
            text-decoration: none;
        }

        #save_btn {
            float: right;
            margin-right: 100px;
            margin-top: 2%;
        }

        #opitions {
            position: fixed;
            top: 0;
            left: 0;
            background: var(--darkback);
            box-shadow: rgba(0,0,0,0.18) 0 3px 15px;
            width: 100%;
            height: 40px;
            opacity: 0;
            color: var(--active);
            transition: all 1s;
            z-index: 999;
        }

            #opitions:hover{
                opacity:1;
                transition:all .2s;
            }

            #opitions strong{
                color:var(--main);
                font-size:18px;
                line-height:40px;
                margin-left:2%;
            }

            #opitions span{
                font-size:16px;
                line-height:40px;
                margin-left:1.5%;
            }

            #opitions button,
            #opitions a{
                background:var(--background);
                color:var(--active);
                border-radius:3px;
                border:none;
                box-shadow:rgba(0,0,0,0.18) 2px 0 10px;
                padding:5px 20px;
                margin:5px .5% 5px .5%;
                outline: none;
                line-height:20px;
                cursor:pointer;
                font-size:13px;
                transition:all .2s;
            }

            #opitions button:hover,
            #opitions a:hover{
                transform: scale(1.07);
            }

                #opitions button:active,
                #opitions a:active{
                    transform: scale(.9);
                }

        body, html {
            background: var(--background);
            font-family: var(--mainfont),monospace;
        }

        
    </style>
    <style id="transition"></style>
</head>
<body onunload="save_content()" id="board">
    <div id="opitions">
        <strong>Clear Writer</strong>
        <span>ä¸»é¢˜</span>
        <button id="theme" onclick="set_theme()">äº®</button>
        <span>è¡Œå·</span>
        <button id="num" onclick="set_line_num()">å…³</button>
        <span onclick="set_stick()" id="stick" style="cursor:pointer">ğŸ“Œ</span>
        <a id="save_btn" href="javascript:$(&#39;#save_form&#39;).submit();void(0);">å¦å­˜ä¸º...</a>
    </div>
    <div id="ctn">
        <form action="http://write4Me.sinaapp.com/save.php" method="post" target="_blank" id="save_form">
            <textarea id="code" name="code" style="display: none;"># Welcome to Clear Writerï¼Œè¿™æ˜¯ä¸€ä¸ªæ²‰æµ¸å¼ Markdown å†™ä½œè½¯ä»¶ã€‚

# ä¸ºä»€ä¹ˆç¼–å†™ Clear Writer
> å…¶å®å†™ä½œï¼Œæœ€éœ€è¦çš„å¹¶ä¸æ˜¯å¾ˆå¥½å¾ˆå¼ºå¤§çš„å·¥å…·ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸æ˜“è®©äººåˆ†å¿ƒçš„ç¯å¢ƒã€‚
Macä¸Šçš„ iA Writer å›ºç„¶èƒ½å¾ˆå¥½åœ°åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½†ä½œä¸ºä¸€ä¸ªåˆäºŒå­¦ç”Ÿï¼Œæˆ‘ç¡®å®ä¹Ÿæ²¡æœ‰é‚£ä¸ªé—²é’±å»ä¹°æ­£ç‰ˆï¼ˆæ¯•ç«Ÿ Win ç«¯ä¸€ç™¾å¤šå—ï¼ŒMac ç«¯ä¸¤ç™¾å¤šå—ï¼‰ã€‚æˆ‘æ‰¾åˆ°äº†ä¸€ä¸ªç±»ä¼¼çš„è½¯ä»¶ï¼Œå«åš 4Me å†™å­—æ¿ï¼Œ[åŸé“¾æ¥ï¼Œç°å·²å¤±æ•ˆ](write.4meapp.com)ã€‚ä½†æ˜¯ï¼Œå®ƒå’Œ iA Writer çš„å·®è·æœªå…æœ‰ç‚¹å¤§â€¦â€¦
4Me å†™å­—æ¿åŸºäº CodeMirrorï¼Œå¾ˆæ–¹ä¾¿è‡ªå®šä¹‰ã€‚
äºæ˜¯æˆ‘å¾æ±‚äº†åŸä½œè€…åŒæ„ä¹‹åï¼Œå€Ÿç€è¿™æ¬¡å› æ­¦æ±‰è‚ºç‚ç–«æƒ…å®…å®¶çš„æ—¶é—´ï¼Œå°è¯•è‡ªå·±ä»¥ 4Me å†™å­—æ¿ä¸ºåŸºç¡€åŠ ä»¥æ”¹è¿›ã€‚åæ­£ç»å†äº†ä¸€é€šå¤§ä¿®å¤§æ”¹ï¼Œæˆ‘åšå‡ºäº†è¿™ä¸ªè‡³å°‘é•¿å¾—å¾ˆåƒ iA Writer çš„æ–‡æœ¬ç¼–è¾‘å™¨ â€”â€” Clear Writerï¼Œæ„å‘³ç€å¸Œæœ›äººä»¬ä½¿ç”¨å®ƒæ—¶ï¼Œå¯ä»¥è®©äººâ€œClearâ€è‡ªå·±çš„æ€ç»´ã€‚

# å…¼å®¹æ€§
âœ” Chrome
âœ” Firefox
âœ” Edge
âŒ IE

# Clear Writer å’Œ 4Me å†™å­—æ¿çš„åŒºåˆ«
- åŠ å…¥å¯é€‰çš„æš—è‰²æ¨¡å¼ï¼›
- åŠ å…¥å¯é€‰çš„è¡Œå·ï¼›
- åŠ å…¥åŠéšè—çš„æ»šåŠ¨æ¡ï¼›
- ä¼˜åŒ–äº†å…‰æ ‡çš„è§‚æ„Ÿï¼ˆä¸ºæ­¤è¿˜ç‰¹æ„ä¿®æ”¹äº†ä¸€ä¸‹ CodeMirror.jsï¼‰ï¼›
- åŠ å…¥äº†ä¸€ä¸ªéšè—å¼çš„é¡¶æ ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥é€‰æ‹©ä¸éšè—ï¼‰ï¼›
- æŠŠâ€œä¿å­˜åˆ°ç”µè„‘â€æŒ‰é’®æŒªåˆ°äº†å³ä¸Šè§’ï¼›
- å®ç°äº†å¸ƒå±€è‡ªé€‚åº”ã€‚
æš‚æ—¶å°±è¿™ä¹ˆå¤šï¼Œä»¥åå†æ…¢æ…¢ä¼˜åŒ–ã€‚

# Clear Writer å’Œ iA Writer çš„åŒºåˆ«
- iA Writer å¯ä»¥å®ç°é«˜äº®å½“å‰å¥å­æˆ–æ®µè½ï¼Œè€Œ Clear Writer åªèƒ½é«˜äº®å½“å‰æ®µè½ï¼Œè€Œä¸”æ˜¯å¿…é€‰çš„ï¼›
- Clear Writer ä¸å…·å¤‡ iA Writer çš„è¯­æ³•é«˜äº®ï¼Œå¦‚æœçœŸçš„æœ‰éœ€è¦ï¼Œå¯ä»¥è¯•ä¸€è¯•è¿™ä¸ª Chrome æ‰©å±•[English Syntax Hightlighter](https://chrome.google.com/webstore/detail/ikdjjgioalkbdihbhcfffjnanhnilipa)ï¼›
- Clear Writer ä¸å…·å¤‡ iA Writer ç»Ÿè®¡å•è¯æ•°é‡å’Œé˜…è¯»æ‰€éœ€æ—¶é—´çš„åŠŸèƒ½ï¼›
å…¶å®æˆ‘è§‰å¾—è™½ç„¶æ²¡æœ‰è¿™äº›åŠŸèƒ½ï¼ŒClear Writer ä¹Ÿç®—è¿˜è¡Œå§ã€‚åæ­£ï¼Œä»¥åæœ‰æ—¶é—´æ…¢æ…¢åŠ å§ã€‚
</textarea>
        </form>
        <div id="save_info"></div>
    </div>

    <script>
        document.getElementById("opitions").style.opacity = "1";

        (function () {
            var
                fullScreenApi = {
                    supportsFullScreen: false,
                    isFullScreen: function () { return false; },
                    requestFullScreen: function () { },
                    cancelFullScreen: function () { },
                    fullScreenEventName: '',
                    prefix: ''
                },
                browserPrefixes = 'webkit moz o ms khtml'.split(' ');

            // check for native support
            if (typeof document.cancelFullScreen != 'undefined') {
                fullScreenApi.supportsFullScreen = true;
            } else {
                // check for fullscreen support by vendor prefix
                for (var i = 0, il = browserPrefixes.length; i < il; i++) {
                    fullScreenApi.prefix = browserPrefixes[i];

                    if (typeof document[fullScreenApi.prefix + 'CancelFullScreen'] != 'undefined') {
                        fullScreenApi.supportsFullScreen = true;

                        break;
                    }
                }
            }

            // update methods to do something useful
            if (fullScreenApi.supportsFullScreen) {
                fullScreenApi.fullScreenEventName = fullScreenApi.prefix + 'fullscreenchange';

                fullScreenApi.isFullScreen = function () {
                    switch (this.prefix) {
                        case '':
                            return document.fullScreen;
                        case 'webkit':
                            return document.webkitIsFullScreen;
                        default:
                            return document[this.prefix + 'FullScreen'];
                    }
                }
                fullScreenApi.requestFullScreen = function (el) {
                    return (this.prefix === '') ? el.requestFullScreen() : el[this.prefix + 'RequestFullScreen']();
                }
                fullScreenApi.cancelFullScreen = function (el) {
                    return (this.prefix === '') ? document.cancelFullScreen() : document[this.prefix + 'CancelFullScreen']();
                }
            }

            // jQuery plugin
            if (typeof jQuery != 'undefined') {
                jQuery.fn.requestFullScreen = function () {

                    return this.each(function () {
                        var el = jQuery(this);
                        if (fullScreenApi.supportsFullScreen) {
                            fullScreenApi.requestFullScreen(el);
                        }
                    });
                };
            }
            // export api
            window.fullScreenApi = fullScreenApi;
        })();
        const darktheme = "*{--background:#1A1C1D;--darkback:#252829;--main:#00BAFF;--selection:#fff2;--active:#fff;--mainfont: 'NeverMind','Noto Sans S Chinese' !important;--line: #333;--com:#fff1;}";
        const lighttheme = "*{--background:#f8f8f8;--darkback:#eee;--main:#00BAFF;--selection:#C2E8F4;--active:#333;--mainfont: 'NeverMind','Noto Sans S Chinese' !important;--line: #ddd;--com:#0001;}";
        const transition = "body,html,.CodeMirror,.cm-comment{transition:background .3s}.CodeMirror-gutter{transition:all .3s}";
        var stick=0;
        if (localStorage.theme)
            if (localStorage.theme == 1) {
                document.getElementById("control").innerHTML = lighttheme;
            }
            else {
                document.getElementById("control").innerHTML = darktheme;
                document.getElementById("theme").innerHTML = "æš—";
            }
        else {
            localStorage.theme = 1;
            document.getElementById("control").innerHTML = lighttheme;
        }

        if (localStorage.line_num) {
            if (localStorage.line_num==2) {
                document.getElementById("num").innerHTML = "å¼€";
            }
        }
        else localStorage.line_num = 1;

        var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
            lineNumbers: (localStorage.line_num-1),
            lineWrapping: true,
            mode: 'markdown',
            onCursorActivity: function () {

                editor.setLineClass(hlLine, null);
                hlLine = editor.setLineClass(editor.getCursor().line, "activeline");

                $("pre.activeline ~ pre").addClass('activeline');
                //console.log($("pre.activeline ~ pre"));
            }
        });

        
        
        function set_theme() {
            if (localStorage.theme == 1) {
                document.getElementById("control").innerHTML = darktheme;
                document.getElementById("theme").innerHTML = "æš—";
                localStorage.theme = 2;
            }
            else {
                document.getElementById("control").innerHTML = lighttheme;
                document.getElementById("theme").innerHTML = "äº®";
                localStorage.theme = 1;
            }
        }
        function set_line_num() {
            editor.save();
            if (localStorage.line_num == 1) localStorage.line_num = 2;
            else localStorage.line_num = 1;
            window.history.go(0);
        }
        function set_stick() {
            if (stick == 0) {
                document.getElementById('opitions').style.opacity = '1';
                stick = 1;
                document.getElementById('stick').innerHTML = 'ğŸ“';
            }
            else {
                document.getElementById('opitions').style.opacity = '';
                stick = 0;
                document.getElementById('stick').innerHTML = 'ğŸ“Œ';
            }
        }

        var hlLine = editor.setLineClass(0, "activeline");

        var local_save = setInterval(save_content, 300000);

        var glvar_isCtrl = false;
        var glvar_ctrlDownTime = 0;

        var skey = window.location;

        setTimeout("document.getElementById('transition').innerHTML = transition;", 300 )
        setTimeout("document.getElementById('opitions').style.opacity = '';", 1000)


        function playSound(url) {
            $("#sound").html("<embed src='" + url + "' hidden=true autostart=true loop=false>");
        }

        function save_content(user) {
            editor.save();
            window.localStorage.setItem(skey, $('#code').val());
            var d = new Date();
            var curr_hour = d.getHours();
            var curr_min = d.getMinutes();

            if (user == 1)
                $('#save_info').html('ä¿å­˜äº ' + curr_hour + 'ç‚¹' + curr_min + 'åˆ†');
            else
                $('#save_info').html('è‡ªåŠ¨ä¿å­˜äº ' + curr_hour + 'ç‚¹' + curr_min + 'åˆ†');
        }

        $(document).ready(function () {

            if (window.localStorage.getItem(skey) !== null) editor.setValue(window.localStorage.getItem(skey));
            else {
                editor.setCursor(3, 22);
                editor.focus();
            }

            $(document).keyup(function (e) {
                if (e.which == 17 || e.which == 224) {
                    glvar_isCtrl = false;
                }

            }).keydown(function (e) {

                if (e.which == 17 || e.which == 224) {
                    glvar_isCtrl = true;
                    glvar_ctrlDownTime = Date.parse(new Date());
                    return false;
                }

                //Ctrl + s
                if (glvar_isCtrl == true) {
                    var curtime = Date.parse(new Date());
                    var timedf = curtime - glvar_ctrlDownTime;
                    if (e.which == 83 && timedf <= 2000) {
                        save_content(1);
                        return false;
                    }
                }
            });
        });

    </script>
</body>
</html>
